<link rel="import" href="/bower/polymer/polymer.html">

<link rel="import" href="/bower/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="/assets/elements/polymer-flip.html">
<link rel="import" href="/assets/elements/draw-card.html">
<link rel="import" href="/assets/elements/place-card.html">

<dom-module id="card-element">
  <style>
    :host {
      width: 100%;
      height: 100%;
      /*transition: all 0.5s;*/
      -webkit-perspective: 1000;
      transform: translate3d(0,0,0) rotateY(180deg);
    }
    img {
      width: 100%;
    }
    img.splash {
      position: absolute;
      width: calc(100% - 10px);
      top: 5px;
      left: 5px;
    }
    .face {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .front.face {
      background: green;
      z-index: 0;
      transform: translate3d(0, 0, 1px);
      /*transform: rotateY(0deg);*/
      backface-visibility: hidden;
    }
    .back.face {
      background: red;
      backface-visibility: hidden;
      z-index: 0;
      transform: translate3d(0, 0, 0px) rotateY(180deg);
    }
  </style>
  <template>
    <div class="front face">
      <!-- <img src="/assets/images/card-front.png"> -->
      <img class="splash" src="/assets/images/foe-creeper.png">
    </div>
    <img class="back face" src="/assets/images/card-back.png">
  </template>

<script>
  Polymer({
    is: "card-element",
    behaviors: [
      Polymer.NeonAnimationRunnerBehavior
    ],
    properties: {
      faceup: {
        type: Boolean,
        value: false,
        notify: true
      },
      front: {
        type: String,
        value: "/assets/images/card-front-background.png"
      },
      back: {
        type: String,
        value: "/assets/images/card-back.png"
      },
      animationConfig: {
        value: function() {
          return {
            'flip': {
              name: 'polymer-flip',
              axis: 'rotateY',
              node: this
            },
            'drawCard': {
              name: 'draw-card',
              node: this
            },
            'placeCard': {
              name: 'place-card',
              node: this
            }
          }
        }
      }
    },
    face: function(face) {
      return this.faceup ? face === 'up' : face === 'down';
    },
    listeners: {
      'neon-animation-finish': '_onNeonAnimationFinish'
    },
    drawCard: function() {
      // this.front = "/assets/images/card-front-background.png";
      this.playAnimation('drawCard', 'draw');
      this.faceup = false;
    },
    placeCard: function() {
      this.playAnimation('placeCard', 'place');
    },
    flip: function() {
      this.playAnimation('flip', 'flip');
      this.faceup = !this.faceup;
    },
    ready: function() {
      if(!this.faceup){
        // this.style.background = "url('"+this.back+"')";
      } else {
        // this.style.background = "url('"+this.front+"')";
      }
      // this.style.backgroundSize = "contain";
      // this.flip();

      // var y = 0;
      // setInterval(function() {
      //   y += 1;
      //   this.style.transform = "rotateY(" + y + "deg)";
      // }.bind(this), 15);
    },
    _onNeonAnimationFinish: function(e, animation) {
      switch(animation){
        case 'draw':
          // this.style.background = "url('" + this.front + "')";
          // this.style.backgroundSize = "contain";
          // this.style.transform = "scale(2) translate(-200px, -60px)";
          var node = this;
          setTimeout(function(){ node.placeCard();}, 1500);
          break;
        case 'place':
          // this.style.transform = "scale(1) translate(-660px, 90px)";
          break;
        case 'flip':
          // TODO: use the correct side (front or back)
          break;
      }
    }
  });
</script>
</dom-module>
