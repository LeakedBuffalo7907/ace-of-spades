<link rel="import" href="/bower/polymer/polymer.html">

<link rel="import" href="/bower/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="/assets/elements/polymer-flip.html">
<link rel="import" href="/assets/elements/draw-card.html">
<link rel="import" href="/assets/elements/place-card.html">

<dom-module id="card-element">
  <style>
    :host {
      display: inline-block;
      height: 200px;
      width: 135px;
      bottom: 10px;
      right: 20px;
      background-size: contain;
    }
  </style>
  <template>
  </template>

<script>
  Polymer({
    is: "card-element",
    behaviors: [
      Polymer.NeonAnimationRunnerBehavior
    ],
    properties: {
      faceup: {
        type: Boolean,
        value: false,
        notify: true
      },
      front: {
        type: String,
        value: "/assets/images/card-front-background.png"
      },
      back: {
        type: String,
        value: "/assets/images/card-back.png"
      },
      animationConfig: {
        value: function() {
          return {
            'flip': {
              name: 'polymer-flip',
              axis: 'rotateY',
              node: this
            },
            'drawCard': {
              name: 'draw-card',
              node: this
            },
            'placeCard': {
              name: 'place-card',
              node: this
            }
          }
        }
      }
    },
    face: function(face) {
      return this.faceup ? face === 'up' : face === 'down';
    },
    listeners: {
      'neon-animation-finish': '_onNeonAnimationFinish'
    },
    drawCard: function() {
      this.front = "/assets/images/card-front-background.png";
      this.playAnimation('drawCard', 'draw');
      this.faceup = false;
    },
    placeCard: function() {
      this.playAnimation('placeCard', 'place');
    },
    flip: function() {
      this.playAnimation('flip');
      this.faceup = !this.faceup;
    },
    ready: function() {
      if(!this.faceup){
        this.style.background = "url('"+this.back+"')";
      } else {
        this.style.background = "url('"+this.front+"')";
      }
      this.style.backgroundSize = "contain";
    },
    _onNeonAnimationFinish: function(e, animation) {
      switch(animation){
        case 'draw':
          this.style.background = "url('/assets/images/card-front-background.png')";
          this.style.backgroundSize = "contain";
          this.style.transform = "scale(2) translate(-200px, -60px)";
          var node = this;
          setTimeout(function(){ node.placeCard();}, 1500);
          break;
        case 'place':
          this.style.transform = "scale(1) translate(-660px, 90px)";
          break;
      }
    }
  });
</script>
</dom-module>
